sudo: required
dist: trusty
language: cpp
compiler:
    - clang

env:
    global:
        - CI_HOME=`pwd`

before_install:
    - sudo apt-get update

      # Ensure add-apt-repository is installed.
    - sudo apt-get install python-software-properties

      # LLVM
    - sudo sh -c "echo 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise main' >> /etc/apt/sources.list"
    - sudo sh -c "echo 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise-3.7 main' >> /etc/apt/sources.list"
    - sudo sh -c "echo 'deb http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu precise main' >> /etc/apt/sources.list"
    - wget -O - http://llvm.org/apt/llvm-snapshot.gpg.key | sudo apt-key add -

    - sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
    - sudo add-apt-repository --yes ppa:h-rayflood/llvm
    
    - sudo apt-key update
    - sudo apt-get update
    
    - git clone https://github.com/libuv/libuv.git


install:
    - cd libuv
    - ./configure && make && sudo make install
    - sudo apt-get -y install g++-4.8 clang-3.7 libgtest-dev google-mock libboost-dev
    - "cd /usr/src/gtest && sudo cmake . && sudo cmake --build . && sudo mv libg* /usr/local/lib/ ; cd -"

script:
    - cd $CI_HOME
    - mkdir build && cd build
    - cmake ..
    - make
    - ./tests/callme_test



