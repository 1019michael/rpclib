sudo: required
dist: trusty
language: cpp
compiler:
    - clang

env:
    global:
        - CI_HOME=`pwd`

before_install:
    - sudo apt-get update

      # Ensure add-apt-repository is installed.
    - sudo apt-get install python-software-properties

      # LLVM
    - sudo sh -c "echo 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise main' >> /etc/apt/sources.list"
    - sudo sh -c "echo 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise-3.7 main' >> /etc/apt/sources.list"
    - sudo sh -c "echo 'deb http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu precise main' >> /etc/apt/sources.list"
    - wget -O - http://llvm.org/apt/llvm-snapshot.gpg.key | sudo apt-key add -

    - sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
    - sudo add-apt-repository --yes ppa:h-rayflood/llvm

    - sudo apt-key update
    - sudo apt-get update

    - git clone https://github.com/libuv/libuv.git
    - git clone https://github.com/google/googletest.git


install:
    - cd libuv
    - ./autogen.sh && ./configure && make -j2 && sudo make install

    - cd $CI_HOME
    - cd googletest
    - mkdir build && cd build
    - cmake -DCMAKE_INSTALL_PREFIX:PATH=/usr ..
    - make -j2 && sudo make install
    - cd ../googlemock
    - mkdir build && cd build
    - cmake -DCMAKE_INSTALL_PREFIX:PATH=/usr ..
    - make -j2 && sudo make install
    - sudo cp -r include /usr

    - sudo apt-get -y install g++-4.8 clang-3.7 libboost-dev

script:
    - cd $CI_HOME
    - mkdir build && cd build
    - cmake ..
    - make -j2
    - ./tests/callme_test



